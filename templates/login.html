{% extends "layout.html" %}

{% block title %}Register for Open Dev Summit '26 - FOSS Community UOK{% endblock %}

{% block nav_items %}{% endblock %}

{% block content %}
<div class="row justify-content-center align-items-center" style="min-height: 70vh;">
    <div class="col-md-6 text-center text-md-start mb-5 mb-md-0">
        <h1 class="display-4 fw-bold mb-3"><span class="text-primary">Open Dev Summit '26</span></h1>
        <p class="lead text-muted mb-4">
            Register now for our upcoming Open Dev Summit '26 and get your entry pass immediately.
            No forms, no hassle - just GitHub.
        </p>
    </div>
    
    <div class="col-md-5 col-lg-5">
        <div class="card p-4 p-lg-5 shadow-lg border-primary-subtle">
            <div class="text-center mb-4">
                <h3 class="fw-bold mb-1">Get Started</h3>
                <p class="text-muted small">Sign in to automatically register</p>
            </div>

            <a href="/auth/github" id="github-btn" class="btn btn-dark w-100 py-3 mb-3 d-flex align-items-center justify-content-center gap-2 rounded-4">
                <i class="bi bi-github fs-5" id="github-icon"></i>
                <span class="spinner-border spinner-border-sm d-none" id="github-spinner" role="status" aria-hidden="true"></span>
                <span id="github-label">Continue with GitHub</span>
            </a>

            <div id="login-error" class="alert alert-warning alert-dismissible fade d-none small py-2 mb-3" role="alert">
                Login didn't go through — please try again.
                <button type="button" class="btn-close btn-close-sm" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>

            <div class="text-center">
                <hr class="text-muted opacity-25">
                <small class="text-muted" style="font-size: 0.75rem;">
                    Sign in triggers automatic event registration and QR code generation.
                </small>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  document.getElementById('github-btn').addEventListener('click', function () {
    document.getElementById('github-icon').classList.add('d-none');
    document.getElementById('github-spinner').classList.remove('d-none');
    document.getElementById('github-label').textContent = 'Redirecting to GitHub…';
    this.classList.add('disabled');
    this.setAttribute('aria-disabled', 'true');
  });

  // Show error banner if redirected back due to a failed OAuth callback
  if (new URLSearchParams(window.location.search).has('error')) {
    const el = document.getElementById('login-error');
    el.classList.remove('d-none');
    el.classList.add('show');
    // Clean the URL so a refresh doesn't re-show the error
    history.replaceState(null, '', '/');
  }
</script>
{% endblock %}
